#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞ –ø–∞–ø–∫–∏ docker_deploy
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞

echo "üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±–æ—Ç–∞..."

# –ò–º—è –∞—Ä—Ö–∏–≤–∞ —Å –¥–∞—Ç–æ–π
ARCHIVE_NAME="bot_deploy_$(date +%Y%m%d_%H%M%S).tar.gz"

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –ø–∞–ø–∫—É
cd "$(dirname "$0")/.."

# –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤, –∏—Å–∫–ª—é—á–∞—è –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã
echo "üì¶ –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –ø–∞–ø–∫—É docker_deploy..."
tar -czf "$ARCHIVE_NAME" \
    --exclude="*.pyc" \
    --exclude="__pycache__" \
    --exclude=".DS_Store" \
    --exclude="*.db" \
    --exclude="*.db-shm" \
    --exclude="*.db-wal" \
    --exclude="*.pickle" \
    docker_deploy/

if [ $? -eq 0 ]; then
    SIZE=$(du -h "$ARCHIVE_NAME" | cut -f1)
    echo "‚úÖ –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!"
    echo "üìÇ –§–∞–π–ª: $ARCHIVE_NAME"
    echo "üíæ –†–∞–∑–º–µ—Ä: $SIZE"
    echo ""
    echo "–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Ñ–∞–π–ª $ARCHIVE_NAME –Ω–∞ –¥—Ä—É–≥–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä"
    echo "–∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –µ–≥–æ –∫–æ–º–∞–Ω–¥–æ–π:"
    echo "  tar -xzf $ARCHIVE_NAME"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—Ä—Ö–∏–≤–∞!"
    exit 1
fi
